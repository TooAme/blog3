<!-- 合并的页面头部 -->
<div class="page-header">
  <h1><a class="brand" href="<%= config.root %>"><%= config.title %></a></h1>
  <h2><span class="title">乐队头像生成器</span></h2>
</div>

<div class="row page">
  <div class="col-md-12">

    <div class="lstation-generator-container">
      <!-- 参数选择区域 -->
      <div id="parameter-section">
        <!-- 角色选择 -->
      <div class="form-group">
        <label for="character-select">选择角色：</label>
        <select id="character-select" class="form-control">
          <option value=""></option>
          <option value="小祥">小祥</option>
          <option value="soyorin1">SOYO - 竖屏</option>
          <option value="soyorin2">SOYO - 横屏</option>
          <option value="乐奈">乐奈</option>
          <option value="偷摸零">偷摸零</option>
          <option value="喵梦">喵梦</option>
          <option value="墨提斯1">墨提斯 - 竖屏</option>
          <option value="墨提斯2">墨提斯 - 横屏</option>
          <option value="爱音1">爱音 - 竖屏</option>
          <option value="爱音2">爱音 - 横屏</option>
          <option value="爱音3">爱音 - 校服横屏</option>
          <option value="睦子米1">睦子米 - 横屏</option>
          <option value="睦子米2">睦子米 - 竖屏</option>
          <option value="立希">立希</option>
          <option value="黄毛大狗">黄毛大狗</option>
        </select>
      </div>

      <!-- 昵称输入 -->
      <div class="form-group">
        <label for="nickname-input">输入昵称：</label>
        <input type="text" id="nickname-input" class="form-control nickname-bar" placeholder="" maxlength="20">
      </div>

        <!-- 字体选择 -->
      <div class="form-group">
        <label for="font-select">昵称字体：</label>
        <select id="font-select" class="form-control">
          <option value="Microsoft YaHei">微软雅黑</option>
          <option value="YouYuan">幼圆</option>
          <option value="SimSun">宋体</option>
          <option value="KaiTi">楷体</option>
          <option value="FangSong">仿宋</option>
          <option value="Arial">Arial</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Georgia">Georgia</option>
          <option value="Verdana">Verdana</option>
          <option value="Tahoma">Tahoma</option>
        </select>
      </div>

      <!-- 颜色选择器 -->
      <div class="form-group">
        <label>昵称颜色：</label>
        <div class="color-selector">
          <!-- 颜色模式选择 -->
          <div class="color-mode-selector">
            <label class="radio-label">
              <input type="radio" name="color-mode" value="single" checked>
              <span>单色</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="color-mode" value="gradient">
              <span>渐变</span>
            </label>
          </div>

          <!-- 颜色选择区域 -->
          <div class="color-picker-container">
            <div class="color-picker-group">
              <label for="color1">颜色1：</label>
              <input type="color" id="color1" value="#25A5D0" class="color-input">
            </div>
            <div class="color-picker-group" id="color2-group" style="display: none;">
              <label for="color2">颜色2：</label>
              <input type="color" id="color2" value="#88D5FB" class="color-input">
            </div>
            <!-- 渐变角度选择 -->
            <div class="gradient-angle-group" id="gradient-angle-group" style="display: none;">
              <label for="gradient-angle">角度：</label>
              <div class="angle-input-container" id="angle-input-container">
                <div class="angle-track">
                  <div class="angle-indicator" id="angle-indicator"></div>
                </div>
                <input type="text" class="angle-value" id="angle-value" value="90" readonly>
              </div>
            </div>
          </div>
        </div>

        <!-- 独立的预览栏 -->
        <div class="form-group">
          <label>预览与布局调整：</label>
          <div class="layout-preview-container">
            <canvas id="layout-preview-canvas" width="400" height="400"></canvas>
            <div class="preview-controls">
              <button type="button" id="reset-layout-btn" class="btn btn-secondary btn-sm">重置布局</button>
              <small class="help-text">拖拽元素调整位置，生成时将使用当前布局</small>
            </div>
          </div>
        </div>
      </div>

      <!-- 选择状态显示 -->
      <!-- <div id="selection-status" class="form-group" style="display: none;">
        <div class="alert alert-info">
          <strong>已选择：</strong><span id="selected-info"></span>
        </div>
      </div> -->



        <!-- 生成按钮 -->
        <div class="form-group">
          <button id="generate-btn" class="btn btn-primary btn-lg generate-btn">开始生成</button>
          <!-- <div class="help-text">
            <small class="text-muted">
              选择角色后将生成包含角色视频的动态头像
            </small>
          </div> -->
        </div>
      </div> <!-- 关闭参数选择区域 -->

      <!-- 加载动画 -->
      <div id="loading-container" style="display: none;">
        <div class="loading-wrapper">
          <div class="loader">
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
          </div>
          <div id="loading-text">准备中...</div>
        </div>
      </div>

      <!-- 预览区域 -->
      <div id="preview-container" style="display: none;">
        <p class="preview-text">预览</p>
        <div id="preview-area">
          <div class="preview-wrapper">
            <canvas id="preview-canvas" width="400" height="400" style="display: none;"></canvas>
            <img id="preview-gif" style="display: none;" />
          </div>
        </div>
        <div class="preview-controls">
          <button id="download-gif-btn" class="btn btn-success">下载GIF</button>
          <button id="regenerate-btn" class="btn btn-secondary">重新生成</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 隐藏的canvas用于处理 -->
<canvas id="hidden-canvas" style="display: none;"></canvas>

<!-- GIF生成库 -->
<script src="<%- config.root %>js/gif.js"></script>

<!-- L站生成器专用脚本 -->
<script src="<%- config.root %>js/lstation-generator.js?v=<%= Date.now() %>"></script>
